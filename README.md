# 最適化計算API

このリポジトリは、野菜の最適な肥料配合を計算するAWS Lambda関数のソースコードを含んでいます。

## 目的

- 野菜の種類と肥料の種類を指定して、最適な肥料配合を計算
- AWS Lambda上で実行されるAPIエンドポイントとして機能
- スマートフォンアプリからのリクエストに対応

## デプロイパッケージの作成方法

1. Dockerイメージのビルドとzipファイルの作成:
```bash
docker build -t lambda-package . && docker create --name temp-container lambda-package && docker cp temp-container:/app/function.zip . && docker rm temp-container
```

2. 作成された`function.zip`をAWS Lambdaにアップロード

## APIの使用方法

### リクエスト例

```bash
curl -X POST https://www.saitekikun.com/hiryou_calc \
  -H "Content-Type: application/json" \
  -H "accept: application/json" \
  -d '{
    "c_yasai": "オリジナル野菜1",
    "c_hiryou": ["オリジナル肥料1", "発酵鶏ふん", "骨粉", "化成肥料(8-8-8)", "もみ殻"],
    "custom_yasai": {
      "yasai": ["オリジナル野菜1", "オリジナル野菜2"],
      "N": [49, 48],
      "P": [70, 71],
      "K": [58, 58],
      "W": [2000, 2000]
    },
    "custom_hiryou": {
      "hiryou": ["オリジナル肥料1", "オリジナル肥料2"],
      "Price": [0.084740741, 0.084740741],
      "N": [0.018, 0.02],
      "P": [0.025, 0.067],
      "K": [0.024, 0.045]
    }
  }'
```

### リクエストパラメータ

- `c_yasai`: 計算対象の野菜名
- `c_hiryou`: 計算対象の肥料のリスト
- `custom_yasai`: 野菜ごとの肥料必要量
  - `yasai`: 野菜名のリスト
  - `N`: 窒素必要量のリスト（kg/10a）
  - `P`: リン酸必要量のリスト（kg/10a）
  - `K`: カリ必要量のリスト（kg/10a）
  - `W`: 水分必要量のリスト（kg/10a）
- `custom_hiryou`: 肥料の情報
  - `hiryou`: 肥料名のリスト
  - `Price`: 肥料単価のリスト（円/kg）
  - `N`: 窒素含有率のリスト
  - `P`: リン酸含有率のリスト
  - `K`: カリ含有率のリスト

### レスポンス例

```json
{
  "result": {
    "status": "Optimal",
    "肥料名": ["オリジナル肥料1", "発酵鶏ふん", "骨粉", "化成肥料(8-8-8)", "もみ殻"],
    "野菜名": "オリジナル野菜1",
    "必要な量": [1952.0, 0.0, 62.8, 140.65, 0.0],
    "最適化後NPKW": [48.9, 70.1, 58.1, 2155.45],
    "理想量": [49.0, 70.0, 58, 2000],
    "総費用": 137.74,
    "カスタム野菜": {
      "yasai": ["オリジナル野菜1", "オリジナル野菜2"],
      "N": [49, 48],
      "P": [70, 71],
      "K": [58, 58],
      "W": [2000, 2000]
    },
    "カスタム肥料": {
      "hiryou": ["オリジナル肥料1", "オリジナル肥料2"],
      "Price": [0.084740741, 0.084740741],
      "N": [0.018, 0.02],
      "P": [0.025, 0.067],
      "K": [0.024, 0.045]
    }
  }
}
```

## 環境要件

- Python 3.10
- 必要なパッケージ:
  - numpy==1.24.3
  - pandas==1.5.3
  - pulp==2.7.0
